classDiagram
direction LR

%% ==========================================
%% 1. Entities (Models)
%% ==========================================
class User {
    -id: string
    -username: string
    -createdAt: string
    -lastLogin: string | null
    +getId(): string
    +getUsername(): string
    +getCreatedAt(): string
    +getLastLogin(): string
}

class Post {
    -id: string
    -authorId: string
    -title: string
    -content: string
    -prompt: string
    -updatedPrompt: string
    -likeCount: number
    -dislikeCount: number
    -viewCount: number
    -category: "free"|"share"|"qna"
    -isDeleted: boolean
    -createdAt: string
    -updatedAt: string
    +setContent(newContent): void
    +setUpdatedPrompt(prompt): void
    +setTitle(newTitle): void
    +setCategory(cat): void
}

class Comment {
    -id: string
    -postId: string
    -authorId: string
    -content: string
    -prompt: string
    -updatedPrompt: string
    -createdAt: string
    -updatedAt: string
    +setContent(content): void
}

class Notification {
    -id: string
    -toUserId: string
    -fromUserId: string
    -postId: string
    -type: "comment"|"like"|"dislike"
    -createdAt: string
    +getType(): string
    +getFromUserId(): string
}

%% ==========================================
%% 2. Services (Business Logic)
%% ==========================================
class UserService {
    +signUpUser(username, password, token): User
    +loginUser(username, password, token): User
    +getCurrentUser(token): User
    +getUserStats(userId): Stats
    +updateUserInfo(userId, newUsername, ...): void
    +deleteUserAndData(userId): void
}

class PostService {
    +createPost(authorId, title, prompt, category): Post
    +updatePostContent(postId, content, updatedPrompt): Post
    +updatePostMeta(postId, title, category): Post
    +getPostById(postId): Post
    +listPostsByCategory(category): Post[]
    +listPostsByUser(userId): Post[]
    +increaseViewCount(postId): void
    +deletePost(postId, authorId): boolean
    +updatePost(postId, authorId, title, content, updatedPrompt): Post
    +listTopLikedPosts(limit): Post[]
}

class CommentService {
    +createComment(postId, authorId, content, prompt): Comment
    +updateCommentContent(commentId, content, updatedPrompt, userId): Comment
    +getCommentById(commentId): Comment
    +listCommentsByPostId(postId): Comment[]
    +deleteComment(commentId, userId): boolean
    +listCommentsByUser(userId): Comment[]
}

class ReactionService {
    +toggleReaction(postId, userId, type): ReactionResult
    +getUserReaction(postId, userId): string
}

class NotificationService {
    +createNotification(toUserId, fromUserId, postId, type): Notification
    +listNotificationsByUser(userId): Notification[]
    +deleteNotification(notiId): boolean
    +deleteAllNotificationsByUser(userId): boolean
}

class AIService {
    +createAIContent(prompt): string
    +updateAIContent(originalContent, prompt): string
}

class CaptchaService {
    +verifyTurnstile(token): boolean
}

%% ==========================================
%% 3. UI Components (Presentation Layer)
%% ==========================================
class RootLayout {
    +render(children): JSX
}

class AuthProvider {
    -isLoggedIn: boolean
    -bgClass: string
    +useAuth(): Context
    +useEffect(): void
}

class AuthHeader {
    -isLoggedIn: boolean
    -username: string
    +handleLogout(): void
    +render(): JSX
}

class BoardPreview {
    -posts: Post[]
    +useEffect(): void
    +fetchPopularPosts(): void
    +render(): JSX
}

class PostList {
    -posts: PostListItem[]
    +render(): JSX
}

class Captcha {
    -siteKey: string
    -token: string
    +onVerify(token): void
    +render(): JSX
}

class ProtectedAction {
    +handleClick(): void
    +render(children): JSX
}

%% ==========================================
%% 4. Relationships
%% ==========================================
%% Entity Relationships
User "1" -- "*" Post : writes
User "1" -- "*" Comment : writes
User "1" -- "*" Notification : sends/receives
Post "1" -- "*" Comment : has
Post "1" -- "*" Notification : target of

%% Service Dependencies
UserService ..> User : Returns
UserService ..> CaptchaService : Uses
PostService ..> Post : Returns
PostService ..> AIService : Uses for generation
CommentService ..> Comment : Returns
CommentService ..> AIService : Uses for generation
ReactionService ..> NotificationService : Calls on reaction

%% UI Dependencies
RootLayout *-- AuthProvider : Wraps
%% 수정된 부분: 따옴표 제거 및 식별자(Identifier) 형태로 변경
AuthProvider ..> LocalStorage : Manages State
AuthHeader ..> AuthProvider : Consumes Context
BoardPreview ..> PostService : Fetches Data
BoardPreview ..> PostList : Renders
PostList ..> Post : Displays
ProtectedAction ..> LocalStorage : Checks Token
Captcha ..> TurnstileAPI : Verifies UI